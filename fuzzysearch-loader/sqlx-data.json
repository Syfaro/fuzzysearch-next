{
  "db": "PostgreSQL",
  "0e2881dd319b7b50e89d0c34f1d4c1bbe7a17feaa06bc3a4fded9c6466aeb48d": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Uuid",
          "Uuid",
          "Text",
          "Text",
          "Bool",
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO submission_media (submission_id, media_id, site_media_id, url, deleted, extra)\n    VALUES ($1, $2, $3, $4, $5, $6)\n    ON CONFLICT DO NOTHING\n    RETURNING id;\n"
  },
  "16a9c86dd416a568464b169d454c7fb87ef9f8a2fb0ec0fd9f664d7856a6ebff": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO submission_artist (submission_id, artist_id)\n    SELECT * FROM jsonb_to_recordset($1)\n        AS submission_artist (submission_id uuid, artist_id uuid)\n    ON CONFLICT DO NOTHING;\n"
  },
  "301e98f7c00bcff99cf3e869c9add64043e0b2e270de6ff41c6693a76df2c51d": {
    "describe": {
      "columns": [
        {
          "name": "site_submission_id",
          "ordinal": 0,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": []
      }
    },
    "query": "SELECT site_submission_id FROM submission WHERE site_id = 1"
  },
  "5c66b318c83f64c01fbd4402199b5253d52c1880fbd460581756210f5993daba": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        },
        {
          "name": "perceptual_gradient",
          "ordinal": 1,
          "type_info": "Int8"
        }
      ],
      "nullable": [
        false,
        true
      ],
      "parameters": {
        "Left": [
          "Bytea"
        ]
      }
    },
    "query": "SELECT\n    media.id,\n    media_frame.perceptual_gradient\nFROM\n    media\n    LEFT JOIN media_frame ON media_frame.media_id = media.id AND media_frame.frame_index = 0\nWHERE\n    file_sha256 IS NOT NULL\n    AND file_sha256 = $1;\n"
  },
  "61f07b8df7dab9f9ad2e9bbd1e36b801f0b89c87a84b293037df564b201682b0": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        },
        {
          "name": "site_name",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "site_submission_id",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "site_media_id",
          "ordinal": 3,
          "type_info": "Text"
        },
        {
          "name": "link",
          "ordinal": 4,
          "type_info": "Text"
        },
        {
          "name": "title",
          "ordinal": 5,
          "type_info": "Text"
        },
        {
          "name": "description",
          "ordinal": 6,
          "type_info": "Text"
        },
        {
          "name": "media_url",
          "ordinal": 7,
          "type_info": "Text"
        },
        {
          "name": "submission_media_extra",
          "ordinal": 8,
          "type_info": "Jsonb"
        },
        {
          "name": "file_sha256",
          "ordinal": 9,
          "type_info": "Bytea"
        },
        {
          "name": "artists",
          "ordinal": 10,
          "type_info": "Jsonb"
        },
        {
          "name": "rating",
          "ordinal": 11,
          "type_info": "Text"
        },
        {
          "name": "posted_at",
          "ordinal": 12,
          "type_info": "Timestamptz"
        },
        {
          "name": "tags",
          "ordinal": 13,
          "type_info": "TextArray"
        },
        {
          "name": "deleted",
          "ordinal": 14,
          "type_info": "Bool"
        },
        {
          "name": "retrieved_at",
          "ordinal": 15,
          "type_info": "Timestamptz"
        },
        {
          "name": "extra",
          "ordinal": 16,
          "type_info": "Jsonb"
        },
        {
          "name": "perceptual_gradient",
          "ordinal": 17,
          "type_info": "Int8"
        },
        {
          "name": "media_id?",
          "ordinal": 18,
          "type_info": "Uuid"
        },
        {
          "name": "file_size",
          "ordinal": 19,
          "type_info": "Int8"
        },
        {
          "name": "mime_type",
          "ordinal": 20,
          "type_info": "Text"
        },
        {
          "name": "frame_index?",
          "ordinal": 21,
          "type_info": "Int8"
        }
      ],
      "nullable": [
        false,
        false,
        false,
        true,
        false,
        true,
        true,
        true,
        true,
        true,
        null,
        true,
        true,
        true,
        null,
        true,
        true,
        true,
        false,
        true,
        true,
        false
      ],
      "parameters": {
        "Left": [
          "Jsonb"
        ]
      }
    },
    "query": "WITH search_query AS (\n    SELECT\n        site.id site_id,\n        query.submission_id\n    FROM jsonb_to_recordset($1)\n        AS query (site_name TEXT, submission_id TEXT)\n    JOIN site ON site.name = query.site_name\n)\nSELECT\n\tDISTINCT ON (submission.site_id, submission.site_submission_id, submission_media.site_media_id)\n\tsubmission.id,\n\tsite.name site_name,\n\tsubmission.site_submission_id,\n\tsubmission_media.site_media_id,\n\tsubmission.link,\n\tsubmission.title,\n\tsubmission.description,\n\tsubmission_media.url media_url,\n\tsubmission_media.extra submission_media_extra,\n\tmedia.file_sha256 file_sha256,\n\t(\n\t\tSELECT\n\t\t\tjsonb_agg(jsonb_build_object('name', artist.display_name, 'link', artist.link))\n\t\tFROM submission_artist\n\t\t\tJOIN artist ON artist.id = submission_artist.artist_id\n\t\tWHERE submission_artist.submission_id = submission.id\n\t) artists,\n\tsubmission.rating,\n\tsubmission.posted_at,\n\tsubmission.tags,\n\t(submission.deleted OR submission_media.deleted) deleted,\n\tsubmission.retrieved_at,\n\tsubmission.extra,\n\tmedia_frame.perceptual_gradient,\n\tmedia.id \"media_id?\",\n\tmedia.file_size,\n\tmedia.mime_type,\n\tmedia_frame.frame_index \"frame_index?\"\nFROM search_query\n    JOIN submission ON submission.site_id = search_query.site_id AND submission.site_submission_id = search_query.submission_id\n\tJOIN site ON site.id = submission.site_id\n\tLEFT JOIN submission_media ON submission_media.submission_id = submission.id\n\tLEFT JOIN media ON media.id = submission_media.media_id\n\tLEFT JOIN media_frame ON media_frame.media_id = media.id\nORDER BY\n\tsubmission.site_id,\n\tsubmission.site_submission_id,\n\tsubmission_media.site_media_id,\n\tmedia_frame.frame_index,\n\tsubmission.retrieved_at DESC NULLS LAST\n"
  },
  "63070fadd75c803f55a494fa97dea244a1682f0772687393ad65689991cb2551": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Text",
          "Text"
        ]
      }
    },
    "query": "INSERT INTO\n    artist (site_id, site_artist_id, display_name, link)\nVALUES\n    ((SELECT id FROM site WHERE name = $1), $2, $3, $4) ON CONFLICT (site_id, site_artist_id)\n        DO UPDATE SET display_name = EXCLUDED.display_name, link = EXCLUDED.link\n    RETURNING id;\n"
  },
  "663a319c44a9490aea7aea1833d4fe78c5d4429dafded1de7cc8274194388687": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Bool",
          "Timestamptz",
          "Text",
          "Text",
          "TextArray",
          "Text",
          "Text",
          "Timestamptz",
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO submission (site_id, site_submission_id, deleted, posted_at, link, title, tags, description, rating, retrieved_at, extra)\n    VALUES ((SELECT id FROM site WHERE name = $1), $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\n    ON CONFLICT (site_id, site_submission_id, content_hash)\n        DO UPDATE SET retrieved_at = EXCLUDED.retrieved_at\n    RETURNING id;\n"
  },
  "72d1c64d687d7a42d8388d9980fe3981e1bdce2b30b6d4863286abc038da1a33": {
    "describe": {
      "columns": [
        {
          "name": "max",
          "ordinal": 0,
          "type_info": "Int8"
        }
      ],
      "nullable": [
        null
      ],
      "parameters": {
        "Left": []
      }
    },
    "query": "SELECT max(site_submission_id::bigint) FROM submission WHERE site_id = 1"
  },
  "7605aa76402531bcdc1257f4937b615fe431d3d4a0431fa5f99f6944bf5abb2d": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO media_frame (media_id, frame_index, perceptual_gradient)\n    SELECT * FROM jsonb_to_recordset($1)\n        AS frame (media_id uuid, frame_index bigint, perceptual_gradient bigint)\n    ON CONFLICT DO NOTHING;\n"
  },
  "b5b38a85243c239b83b1ceb270e92a701d708bd6a02c9c45c1a03961c95d234a": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Bytea",
          "Int8",
          "Text",
          "Bool"
        ]
      }
    },
    "query": "INSERT INTO\n    media (file_sha256, file_size, mime_type, single_frame)\nVALUES\n    ($1, $2, $3, $4) ON CONFLICT DO NOTHING RETURNING id;\n"
  },
  "c2ddab265813d0454291a35b09c1f1f7a16889912266103217cbf8cfaf7e89fd": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Bytea"
        ]
      }
    },
    "query": "SELECT\n    id\nFROM\n    media\nWHERE\n    file_sha256 IS NOT NULL\n    AND file_sha256 = $1;\n"
  },
  "fa935204dc37790efe7511528d3eeb0278e4747f2cf4f20fa0a9da835e94c172": {
    "describe": {
      "columns": [
        {
          "name": "name",
          "ordinal": 0,
          "type_info": "Text"
        },
        {
          "name": "site_submission_id",
          "ordinal": 1,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int8Array"
        ]
      }
    },
    "query": "SELECT\n\tDISTINCT ON (submission.site_id, submission.site_submission_id)\n\tsite.name,\n\tsubmission.site_submission_id\nFROM\n\tmedia_frame\n\tJOIN submission_media ON submission_media.media_id = media_frame.media_id\n    JOIN media ON media.id = submission_media.media_id\n\tJOIN submission ON submission.id = submission_media.submission_id\n\tJOIN site ON site.id = submission.site_id\nWHERE\n\tmedia_frame.perceptual_gradient = ANY($1)\n\tAND media_frame.perceptual_gradient IS NOT NULL\n    AND media.single_frame = true\nORDER BY\n\tsubmission.site_id,\n\tsubmission.site_submission_id,\n\tsubmission.retrieved_at DESC NULLS LAST;\n"
  }
}