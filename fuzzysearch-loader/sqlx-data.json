{
  "db": "PostgreSQL",
  "16a9c86dd416a568464b169d454c7fb87ef9f8a2fb0ec0fd9f664d7856a6ebff": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO submission_artist (submission_id, artist_id)\n    SELECT * FROM jsonb_to_recordset($1)\n        AS submission_artist (submission_id uuid, artist_id uuid)\n    ON CONFLICT DO NOTHING;\n"
  },
  "25dcf2a7eb3d50e3ea5994e897e30c38e9d6dfb36d191857ac0788cb70f7da16": {
    "describe": {
      "columns": [
        {
          "name": "id!",
          "ordinal": 0,
          "type_info": "Uuid"
        },
        {
          "name": "site!",
          "ordinal": 1,
          "type_info": "Text"
        },
        {
          "name": "site_submission_id!",
          "ordinal": 2,
          "type_info": "Text"
        },
        {
          "name": "link!",
          "ordinal": 3,
          "type_info": "Text"
        },
        {
          "name": "title",
          "ordinal": 4,
          "type_info": "Text"
        },
        {
          "name": "description",
          "ordinal": 5,
          "type_info": "Text"
        },
        {
          "name": "rating",
          "ordinal": 6,
          "type_info": "Text"
        },
        {
          "name": "posted_at",
          "ordinal": 7,
          "type_info": "Timestamptz"
        },
        {
          "name": "tags",
          "ordinal": 8,
          "type_info": "TextArray"
        },
        {
          "name": "deleted!",
          "ordinal": 9,
          "type_info": "Bool"
        },
        {
          "name": "retrieved_at",
          "ordinal": 10,
          "type_info": "Timestamptz"
        },
        {
          "name": "extra",
          "ordinal": 11,
          "type_info": "Jsonb"
        },
        {
          "name": "artists: sqlx::types::Json<Vec<fuzzysearch_common::Artist>>",
          "ordinal": 12,
          "type_info": "Jsonb"
        },
        {
          "name": "media: sqlx::types::Json<Vec<fuzzysearch_common::Media>>",
          "ordinal": 13,
          "type_info": "Jsonb"
        }
      ],
      "nullable": [
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true,
        true
      ],
      "parameters": {
        "Left": [
          "Jsonb"
        ]
      }
    },
    "query": "WITH search_query AS (\n\tSELECT\n\t\tsite.id site_id,\n\t\tquery.site_submission_id\n\tFROM jsonb_to_recordset($1) AS query (site TEXT, site_submission_id TEXT)\n\tJOIN site ON site.name = query.site\n)\nSELECT DISTINCT ON (submission_detail.site_id, submission_detail.site_submission_id)\n\tsubmission_detail.id \"id!\",\n\tsubmission_detail.site \"site!\",\n\tsubmission_detail.site_submission_id \"site_submission_id!\",\n\tsubmission_detail.link \"link!\",\n\tsubmission_detail.title,\n\tsubmission_detail.description,\n\tsubmission_detail.rating,\n\tsubmission_detail.posted_at,\n\tsubmission_detail.tags,\n\tsubmission_detail.deleted \"deleted!\",\n\tsubmission_detail.retrieved_at,\n\tsubmission_detail.extra,\n\tsubmission_detail.artists \"artists: sqlx::types::Json<Vec<fuzzysearch_common::Artist>>\",\n\tsubmission_detail.media \"media: sqlx::types::Json<Vec<fuzzysearch_common::Media>>\"\nFROM search_query\n\tJOIN submission_detail ON submission_detail.site_id = search_query.site_id AND submission_detail.site_submission_id = search_query.site_submission_id\nORDER BY\n\tsubmission_detail.site_id,\n\tsubmission_detail.site_submission_id,\n\tsubmission_detail.retrieved_at DESC NULLS LAST;\n"
  },
  "4cb07a94fe6b1d30141dcda6e63690909ce217e681d40e17ed736ef4fd7a2292": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Bool",
          "Timestamptz",
          "Text",
          "Text",
          "TextArray",
          "Text",
          "Text",
          "Timestamptz",
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO submission (site_id, site_submission_id, deleted, posted_at, link, title, tags, description, rating, retrieved_at, extra)\n    VALUES ((SELECT id FROM site WHERE name = $1), $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\n    ON CONFLICT DO NOTHING\n    RETURNING id;\n"
  },
  "63070fadd75c803f55a494fa97dea244a1682f0772687393ad65689991cb2551": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Text",
          "Text",
          "Text",
          "Text"
        ]
      }
    },
    "query": "INSERT INTO\n    artist (site_id, site_artist_id, display_name, link)\nVALUES\n    ((SELECT id FROM site WHERE name = $1), $2, $3, $4) ON CONFLICT (site_id, site_artist_id)\n        DO UPDATE SET display_name = EXCLUDED.display_name, link = EXCLUDED.link\n    RETURNING id;\n"
  },
  "7605aa76402531bcdc1257f4937b615fe431d3d4a0431fa5f99f6944bf5abb2d": {
    "describe": {
      "columns": [],
      "nullable": [],
      "parameters": {
        "Left": [
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO media_frame (media_id, frame_index, perceptual_gradient)\n    SELECT * FROM jsonb_to_recordset($1)\n        AS frame (media_id uuid, frame_index bigint, perceptual_gradient bigint)\n    ON CONFLICT DO NOTHING;\n"
  },
  "7debadb757ba05af264ce7664d064d43d2c72a6798e287c81766c689a9ccd453": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Uuid",
          "Uuid",
          "Text",
          "Text",
          "Jsonb"
        ]
      }
    },
    "query": "INSERT INTO submission_media (submission_id, media_id, site_media_id, url, extra)\n    VALUES ($1, $2, $3, $4, $5)\n    ON CONFLICT DO NOTHING\n    RETURNING id;\n"
  },
  "af80bca1225e91582184050d51a649d347b1febf4bf9c6351e4f21a9718233ab": {
    "describe": {
      "columns": [
        {
          "name": "site_submission_id",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        null
      ],
      "parameters": {
        "Left": []
      }
    },
    "query": "SELECT site_submission_id::integer FROM submission WHERE site_id = 1"
  },
  "b5b38a85243c239b83b1ceb270e92a701d708bd6a02c9c45c1a03961c95d234a": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Bytea",
          "Int8",
          "Text",
          "Bool"
        ]
      }
    },
    "query": "INSERT INTO\n    media (file_sha256, file_size, mime_type, single_frame)\nVALUES\n    ($1, $2, $3, $4) ON CONFLICT DO NOTHING RETURNING id;\n"
  },
  "bf626ace928a2cfa0756f353b4608ce41d65ff10dee5187f3ab64431bbe10a94": {
    "describe": {
      "columns": [
        {
          "name": "max",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        null
      ],
      "parameters": {
        "Left": []
      }
    },
    "query": "SELECT max(site_submission_id::integer) FROM submission WHERE site_id = 1 AND deleted = false"
  },
  "c2ddab265813d0454291a35b09c1f1f7a16889912266103217cbf8cfaf7e89fd": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        }
      ],
      "nullable": [
        false
      ],
      "parameters": {
        "Left": [
          "Bytea"
        ]
      }
    },
    "query": "SELECT\n    id\nFROM\n    media\nWHERE\n    file_sha256 IS NOT NULL\n    AND file_sha256 = $1;\n"
  },
  "d0f210d1e87912aae656e30a566ed07efc2448350a68bcd4edd15b16ad36d9a0": {
    "describe": {
      "columns": [
        {
          "name": "id",
          "ordinal": 0,
          "type_info": "Uuid"
        },
        {
          "name": "perceptual_gradients",
          "ordinal": 1,
          "type_info": "Int8Array"
        }
      ],
      "nullable": [
        false,
        null
      ],
      "parameters": {
        "Left": [
          "Bytea"
        ]
      }
    },
    "query": "SELECT\n    media.id,\n    array_agg(media_frame.perceptual_gradient ORDER BY media_frame.frame_index) perceptual_gradients\nFROM\n    media\n    JOIN media_frame ON media_frame.media_id = media.id\nWHERE\n    file_sha256 IS NOT NULL\n    AND file_sha256 = $1\nGROUP BY\n    1;\n"
  },
  "e95829d7915def1812646a2dff11bbd0014b3c9c291dacfdb80627bf972eeb48": {
    "describe": {
      "columns": [
        {
          "name": "one",
          "ordinal": 0,
          "type_info": "Int4"
        }
      ],
      "nullable": [
        null
      ],
      "parameters": {
        "Left": [
          "Text"
        ]
      }
    },
    "query": "SELECT 1 one FROM submission WHERE site_id = 1 AND site_submission_id = $1"
  },
  "fa935204dc37790efe7511528d3eeb0278e4747f2cf4f20fa0a9da835e94c172": {
    "describe": {
      "columns": [
        {
          "name": "name",
          "ordinal": 0,
          "type_info": "Text"
        },
        {
          "name": "site_submission_id",
          "ordinal": 1,
          "type_info": "Text"
        }
      ],
      "nullable": [
        false,
        false
      ],
      "parameters": {
        "Left": [
          "Int8Array"
        ]
      }
    },
    "query": "SELECT\n\tDISTINCT ON (submission.site_id, submission.site_submission_id)\n\tsite.name,\n\tsubmission.site_submission_id\nFROM\n\tmedia_frame\n\tJOIN submission_media ON submission_media.media_id = media_frame.media_id\n    JOIN media ON media.id = submission_media.media_id\n\tJOIN submission ON submission.id = submission_media.submission_id\n\tJOIN site ON site.id = submission.site_id\nWHERE\n\tmedia_frame.perceptual_gradient = ANY($1)\n\tAND media_frame.perceptual_gradient IS NOT NULL\n    AND media.single_frame = true\nORDER BY\n\tsubmission.site_id,\n\tsubmission.site_submission_id,\n\tsubmission.retrieved_at DESC NULLS LAST;\n"
  }
}